---
const { profile } = Astro.props
const realAge = profile.row.d_age
const modelGuess = profile.row.d_age // Replace with actual model guess
---

<div class="w-1/3 flex flex-col gap-6">
	<!-- Your Guess Input -->
	<div class="card card--pink text-center">
		<h4>Your Guess</h4>
		<input
			id="user-guess"
			type="number"
			min="18"
			class="text-2xl text-center w-full mb-2 border rounded-full py-3"
		/>
		<button
			id="submit-guess"
			class="button w-full mt-2 cursor-pointer"
			data-real-age={realAge}
		>
			Submit Guess
		</button>
	</div>

	<!-- Hidden elements initially -->
	<div
		id="real-age-card"
		class="card card--peach text-center hidden"
	>
		<h4>Real Age</h4>
		<p class="text-4xl mb-0">{realAge}</p>
	</div>

	<div
		id="model-guess-card"
		class="card card--peach text-center hidden"
	>
		<h4>Our Model's Guesses</h4>
		<p class="text-4xl mb-0">{modelGuess}</p>
	</div>

	<div
		id="feedback-message"
		class="text-center mt-2 text-lg font-semibold hidden"
	>
	</div>

	<a
		href="#!"
		id="play-again"
		class="button text-center mt-4 hidden"
	>
		Play Again
	</a>
</div>

<script is:inline>
	const submitBtn = document.getElementById("submit-guess")
	const guessInput = document.getElementById("user-guess")
	const realCard = document.getElementById("real-age-card")
	const modelCard = document.getElementById("model-guess-card")
	const feedbackMsg = document.getElementById("feedback-message")
	const playAgainBtn = document.getElementById("play-again")

	submitBtn.addEventListener("click", () => {
		const userGuess = Number(guessInput.value)
		const realAge = Number(submitBtn.dataset.realAge)

		if (isNaN(userGuess)) return

		// Calculate feedback
		const diff = Math.abs(userGuess - realAge)
		let feedback = ""
		if (diff === 0) feedback = "Perfect! ðŸŽ¯"
		else if (diff <= 5) feedback = "So close! ðŸ”¥"
		else feedback = "Better luck next time! ðŸ˜…"

		// Reveal cards and message
		realCard.classList.remove("hidden")
		modelCard.classList.remove("hidden")
		feedbackMsg.textContent = feedback
		feedbackMsg.classList.remove("hidden")
		playAgainBtn.classList.remove("hidden")

		// Disable input/button
		guessInput.disabled = true
		submitBtn.disabled = true
	})

	playAgainBtn.addEventListener("click", () => {
		// Reset everything
		guessInput.value = ""
		guessInput.disabled = false
		submitBtn.disabled = false
		realCard.classList.add("hidden")
		modelCard.classList.add("hidden")
		feedbackMsg.classList.add("hidden")
		playAgainBtn.classList.add("hidden")
	})
</script>
